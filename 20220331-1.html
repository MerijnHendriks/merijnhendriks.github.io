<!DOCTYPE html><html lang="en"><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="description" content="My personal blog"> <meta name="author" content="Merijn Hendriks"> <title>Merijn Hendriks</title> <link rel="icon" type="image/x-icon" href="./assets/img/favicon.ico"> <link rel="stylesheet" type="text/css" href="./assets/css/bundle.css"> </head> <body> <div class="container-fluid min-vh-100 d-flex flex-column"> <div class="p-5 blog-banner"> <div class="container-fluid py-5"> <h1 class="display-5 fw-bold"><a href="./index.html">Merijn Hendriks</a></h1> <p class="col-md-8 fs-4">Programmer, Creative, Nerd</p> </div> </div> <div class="row flex-grow-1"> <div class="col-md-8 p-5" id="blog-content"><h1 id="goto">Goto</h1> <p>For some reason most people I worked with spotted <code>goto</code> somewhere, they always overreacted followed by an extistential crisis. Like with many other programming constructs that these days are frowned upon by the masses (pointers, manual memory allocation), the <code>goto</code> statement is very versatile that requires a sensible programmer to write sensible code. Sadly the older I get, the less people understand what <code>goto</code> is and how to use it (effectively).</p> <p>In many cases we don't need <code>goto</code> to emulate control structures since in most (modern) programming languages alternatives exist, but I think it is very useful to know regardless for understanding of the inner workings of the constrol structured we use on a day-to-day basis as well for preserving knowledge; how to write advanced control structures without having modern tools at your disposal.</p> <p>While I can give the full theory, I always learned more from reading code and poking around with it. To make things a bit easier, I'll include mosly C89 snippets and one java snippet (labled break).</p> <h2 id="while">While</h2> <pre class="language-c" tabindex="0"><code><span class="token comment">/* while: keyword */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* while: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

loop_begin<span class="token operator">:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
    <span class="token keyword">goto</span> loop_begin<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>I think both a very self-explanatory. Pretty easy to emulate, but having a dedicated <code>while</code> control statement is really sweet. One line less code, clear denotion of scope and easier to read.</p> <h2 id="do-while">Do-while</h2> <pre class="language-c" tabindex="0"><code><span class="token comment">/* do-while: keyword */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">do</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* do-while: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

loop_begin<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span> <span class="token keyword">goto</span> loop_begin<span class="token punctuation">;</span>
</code></pre> <p>To my surprise the <code>goto</code> variant is about two lines smaller than the control structure variant, as well as the shortest loop variant in line count (with allman, for otbs its the same). In addition, it is in my opinion slightly to read as well because it's explicit in code flow.</p> <h2 id="break">Break</h2> <pre class="language-c" tabindex="0"><code><span class="token comment">/* break: keyword */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* break: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">goto</span> loop_end<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
loop_end<span class="token operator">:</span>
</code></pre> <p>The <code>goto</code> variant uses one more line of code to no one's suprise. Those calling the <code>break</code> statement "goto in sheep's clothing" would be correct, because it is.</p> <p>The biggest advantage for the goto variant is that you can break out of multiple loops at once:</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* break outer: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">goto</span> loop_end<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
loop_end<span class="token operator">:</span>
</code></pre> <p>In modern programming languages they opt to include "labled break", which is really just a goto. To me it's incredibly stupid. But hey, to each their own.</p> <pre class="language-java" tabindex="0"><code><span class="token comment">// break outer: labeled (java)</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

loop_end<span class="token operator">:</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span> loop_end<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>The anti-goto faction might propose this alternative instead:</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* break outer: keyword */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            l <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>…but this introduces a new state, produces more generated code and is slower. This gets increasingly more complex the more nestled loops exist, and thus not very scalable either. So overall I would argue that this is a degradation in code quality,</p> <h2 id="continue">Continue</h2> <pre class="language-c" tabindex="0"><code><span class="token comment">/* continue: keyword */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* continue: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

loop_begin<span class="token operator">:</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">goto</span> loop_begin<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>Pretty much the same as the <code>break</code> statement, but the label is at the top of the loop. An unique advantage to using <code>goto</code> over <code>continue</code> means that I can can continue from the outer loop.</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* continue outer: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

loop_begin<span class="token operator">:</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">goto</span> loop_begin<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>This of course can also be achieved by breaking the inner loop, but this gets increasingly more complex when nestling more than one loop.</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* continue outer: break */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <h3 id="jump-table">Jump table</h3> <pre class="language-c" tabindex="0"><code><span class="token comment">/* jump table: switch-case */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">switch</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* jump table: goto */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_1<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_2<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_2<span class="token punctuation">;</span>
<span class="token keyword">goto</span> case_default<span class="token punctuation">;</span>

case_1<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">goto</span> switch_end<span class="token punctuation">;</span>

case_2<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">goto</span> switch_end<span class="token punctuation">;</span>

case_default<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">goto</span> switch_end<span class="token punctuation">;</span>

switch_end<span class="token operator">:</span>
</code></pre> <p>The code itself is quite readable, intent is clear and not much harder to understand. It is however much flatter and more explicit in codeflow whereas switch-case has a clearer denotion of scope.</p> <p>What suprised me most is that the <code>goto</code> variant of the switch-case construct isn't even that much bigger in code length. It takes ~1 more line (addition of the if-goto) per case, and an additional line for the end label (<code>switch_end</code>).</p> <p>The code of the <code>goto</code> variant could've been made shorter to make it match the same amount of lines of code taken to write the switch-case variant.</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* jump table: goto - shorter */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_1<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_2<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> case_2<span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">goto</span> switch_end<span class="token punctuation">;</span>

case_1<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">goto</span> switch_end<span class="token punctuation">;</span>

case_2<span class="token operator">:</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

switch_end<span class="token operator">:</span>
</code></pre> <p>This was achieved by:</p> <ul> <li>Moving the content of the label <code>case_default</code> underneath the if block</li> <li>Removing the redundant <code>goto switch_end</code> jump</li> </ul> <p>However, I think that the consistency in the previous variant makes it easier to identify what goes on here.</p> <p>Of course, those with religious believe that <code>goto</code> is harmful no matter what would probably argue that this is a better construct in the event that switch-case is not available:</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* jump table: if-else */</span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Case: none"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>…which is valid considering the amount of cases we have, but this quickly gets out of hand when having many statements in your code.</p> <p><img src="./assets/img/20220331-1/yandere-simulator.jpg" alt="img"></p> <p><em>Yandere Simulator's code, picture by Apterygiformes</em></p> <h2 id="cleanup">Cleanup</h2> <pre class="language-c" tabindex="0"><code><span class="token comment">/* cleanup: if-return */</span>

<span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p1<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* use p1 here */</span>

p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* use p2 here */</span>

p3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p3<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* use p3 here */</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* cleanup: goto */</span>

<span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p1<span class="token punctuation">)</span> <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>

<span class="token comment">/* use p1 here */</span>

p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p2<span class="token punctuation">)</span> <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>

<span class="token comment">/* use p2 here */</span>

p3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p3<span class="token punctuation">)</span> <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>

<span class="token comment">/* use p3 here */</span>

cleanup<span class="token operator">:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>While both do the same thing, the <code>goto</code> variant is much more concise. I really can't think of a better way to do this than by using <code>goto</code>.</p> <p>The same technique can be used as an elegant way for error handling, emulating the exception mechanism found in modern languages without the large environment it requires to operate.</p> <p>Both the if-return and <code>goto</code> variant can be written slightly more concise in case allocation is not dependant on the previous ones:</p> <pre class="language-c" tabindex="0"><code><span class="token comment">/* cleanup: if-return - shorter */</span>

<span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p1 <span class="token operator">||</span> <span class="token operator">!</span>p2 <span class="token operator">||</span> <span class="token operator">!</span>p3<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* use allocated memory here */</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <pre class="language-c" tabindex="0"><code><span class="token comment">/* cleanup: goto - shorter */</span>

<span class="token keyword">void</span> <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p1 <span class="token operator">||</span> <span class="token operator">!</span>p2 <span class="token operator">||</span> <span class="token operator">!</span>p3<span class="token punctuation">)</span> <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>

<span class="token comment">/* use allocated memory here */</span>

cleanup<span class="token operator">:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <p>While both are now far simpler, the <code>goto</code> variant still has less redundancy because we only have to write the cleanup code once.</p> <h2 id="conclusion">Conclusion</h2> <p>The <code>goto</code> statement is a versatile tool that can be used for emulating control flow that does not exist in a language, in addition to use for cleanup and handling errors in a simple yet effective way. If there is something I learned from the journey of exploring goto, its this:</p> <p>It isn't <code>goto</code> that should be considered harmful, but the programmer who doesn't know what he is doing with it.</p> <p>In the end, we are just craftsman who use the tools available to us for the craft. A skilled craftsman learns how to use his tools, how to use them for his craft and explores new ways to further his craftsmanship. A harmful craftsman is one that doesn't understand his tools nor what he is doing and has no capabilities to think for himself. Turning the tools we yield from steel to rubber doesn't make it any less lethal, it just makes skilled craftsman less effective at the job and harmful craftsman will still find a way to fuck it up.</p></div> <div class="col-md-4 p-5 blog-sidebar"> <h4>About</h4> <p>Hi! I'm a Dutch software architect. When I'm not programming all day, you can find me playing D&amp;D5E / MTG / video games with friends, reading manga / watching anime, or daydreaming. Love sushi, salmon, researching, making things work and cute things.</p> <h4>Links</h4> <ul> <li><a href="https://www.github.com/merijnhendriks">Github</a></li> <li><a href="mailto:merijn.d.hendriks@gmail.com">Email</a></li> </ul> </div> </div> </div> </body></html>